(()=>{"use strict";var e={openPopupAvatarBut:"#popup-avatar-but",openPopupRedactBut:"#popup-redact-but",openPopupAddBut:"#popup-add-but",popupAvatar:"#popup-avatar",popupRedact:"#popup-redact",popupAdd:"#popup-add",popupImg:"#popup-img",popupDel:"#popup-del",titleName:".person__title",subtitleJob:".person__job",avatarImg:".person__photo",cardsContainer:"#photos",templateSelector:"#card-template"},t={fieldsetSelector:".popup__fieldset",inputSelector:".popup__input",submitButtonSelector:".popup__submit-btn",inactiveButtonClass:"popup__submit-btn_disabled",inputErrorClass:"popup__input_error",errorClass:"popup__input-error"};function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var o=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._formSelectors=t,this._currentForm=n,this._submitBtn=this._currentForm.querySelector(this._formSelectors.submitButtonSelector)}var t,o;return t=e,(o=[{key:"enableValidation",value:function(){var e=this;Array.from(this._currentForm.querySelectorAll(this._formSelectors.fieldsetSelector)).forEach((function(t){e._fieldset=t,e._setEventListeners()}))}},{key:"_setEventListeners",value:function(){var e=this;this._inputList=Array.from(this._fieldset.querySelectorAll(this._formSelectors.inputSelector)),this._toggleButtonState(),this._inputList.forEach((function(t){t.addEventListener("input",(function(){e._checkInputValidity(t),e._toggleButtonState()}))}))}},{key:"_toggleButtonState",value:function(){this._hasValidInput(this._inputList)?(this._submitBtn.classList.remove(this._formSelectors.inactiveButtonClass),this._submitBtn.removeAttribute("disabled")):(this._submitBtn.classList.add(this._formSelectors.inactiveButtonClass),this._submitBtn.setAttribute("disabled",!0))}},{key:"_hasValidInput",value:function(){return!this._inputList.some((function(e){return!e.validity.valid}))}},{key:"_checkInputValidity",value:function(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}},{key:"_showInputError",value:function(e,t){var n=this._fieldset.querySelector(".".concat(e.id.replace(/([0-9])/g,""),"-error"));e.classList.add(this._formSelectors.inputErrorClass),n.textContent=t,n.classList.add(this._formSelectors.errorClass)}},{key:"_hideInputError",value:function(e){var t=this._fieldset.querySelector(".".concat(e.id.replace(/([0-9])/g,""),"-error"));e.classList.remove(this._formSelectors.inputErrorClass),t.classList.remove(this._formSelectors.errorClass),t.textContent=""}},{key:"removeValidationErrors",value:function(){var e=this;this._inputList.forEach((function(t){e._hideInputError(t)})),this._toggleButtonState()}},{key:"_disableButtonState",value:function(){this._submitBtn.classList.add(this._formSelectors.inactiveButtonClass),this._submitBtn.setAttribute("disabled",!0)}}])&&n(t.prototype,o),e}();function r(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var i=function(){function e(t,n){var o=t.renderer,r=n.cardsContainer;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._cardsContainer=document.querySelector(r),this._renderer=o}var t,n;return t=e,(n=[{key:"renderCards",value:function(e){this._renderedItems=e;for(var t=this._renderedItems.length-1;t>=0;t--)this._renderer(this._renderedItems[t])}},{key:"addItem",value:function(e){this._cardsContainer.prepend(e)}}])&&r(t.prototype,n),e}();function s(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._titleName=document.querySelector(t.titleName),this._subtitleJob=document.querySelector(t.subtitleJob),this._userAvatar=document.querySelector(t.avatarImg)}var t,n;return t=e,(n=[{key:"setUserInfo",value:function(e){this._titleName.textContent=e.name,this._subtitleJob.textContent=e.about,this._userId=e._id}},{key:"getUserInfo",value:function(){return{titleName:this._titleName.textContent,subtitleJob:this._subtitleJob.textContent,userId:this._userId}}},{key:"setNewAvatar",value:function(e){this._userAvatar.src=e.avatar}}])&&s(t.prototype,n),e}();function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var c=function(){function e(t,n,o){var r=o.selectors,i=o.handleCardClick,s=o.handleDelClick;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._api=n,this._cardTemplate=r.templateSelector,this._handleCardClick=i,this._handleDelClick=s,this._name=t.name,this._link=t.link,this._owner=t.owner,this._likes=t.likes,this._cardId=t._id}var t,n;return t=e,(n=[{key:"generateCard",value:function(e){return this._element=this._getTemplate(),this._setEventListeners(),this._cardImg=this._element.querySelector(".photos__image"),this._cardTitle=this._element.querySelector(".photos__title"),this._likeCounter=this._element.querySelector(".photos__like-counter"),this._cardImg.src=this._link,this._cardImg.alt=this._name,this._cardTitle.textContent=this._name,this._likeCounter.textContent=this._likes.length,e.userId===this._owner._id&&(this._element.querySelector(".photos__icon-del").style.display="block"),+this._likeCounter.textContent<1&&(this._element.querySelector(".photos__like-counter").style.display="none",this._element.querySelector(".photos__like-column").style.display="block"),this._likes.find((function(t){return t._id===e.userId}))&&this._element.querySelector(".photos__icon").classList.add("photos__icon_active"),this._element}},{key:"_getTemplate",value:function(){return document.querySelector(this._cardTemplate).content.querySelector(".card").cloneNode(!0)}},{key:"_setEventListeners",value:function(){var e=this,t=this._element.querySelector(".photos__icon"),n=this._element.querySelector(".photos__icon-del"),o=this._element.querySelector(".photos__image"),r=this._element.querySelector(".photos__string");t.addEventListener("click",(function(){return e._handleLikeClick(t)})),n.addEventListener("click",(function(){return e._handleDelClick(e._element)})),o.addEventListener("click",(function(){return e._handleCardClick(o,r)}))}},{key:"_handleLikeClick",value:function(e){var t=this;e.classList.contains("photos__icon_active")?this._api.deleteLike(this._cardId).then((function(n){e.classList.remove("photos__icon_active"),t._likeCounter.textContent=n.likes.length,+t._likeCounter.textContent<1&&(t._element.querySelector(".photos__like-counter").style.display="none",t._element.querySelector(".photos__like-column").style.display="block")})).catch((function(e){return console.log("АЛЯРМ!: ".concat(e))})):this._api.putLike(this._cardId).then((function(n){e.classList.add("photos__icon_active"),t._likeCounter.textContent=n.likes.length,t._element.querySelector(".photos__like-counter").style.display="block",t._element.querySelector(".photos__like-column").style.display="flex"})).catch((function(e){return console.log("АЛЯРМ!: ".concat(e))}))}}])&&a(t.prototype,n),e}();function l(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._url=t.baseUrl,this._headers=t.headers}var t,n;return t=e,(n=[{key:"_sendRequest",value:function(e,t){return fetch("".concat(this._url,"/").concat(e),t).then((function(e){return e.ok?e.json():Promise.reject(e.status)}))}},{key:"getCards",value:function(){return this._sendRequest("cards",{method:"GET",headers:this._headers})}},{key:"getUserInfo",value:function(){return this._sendRequest("users/me",{method:"GET",headers:this._headers})}},{key:"postCard",value:function(e,t){return this._sendRequest("cards",{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})})}},{key:"changeUserInfo",value:function(e){return this._sendRequest("users/me",{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e.name,about:e.about})})}},{key:"changeAvatar",value:function(e){return this._sendRequest("users/me/avatar",{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})})}},{key:"putLike",value:function(e){return this._sendRequest("cards/likes/".concat(e),{method:"PUT",headers:this._headers})}},{key:"deleteLike",value:function(e){return this._sendRequest("cards/likes/".concat(e),{method:"DELETE",headers:this._headers})}},{key:"deleteCard",value:function(e){return this._sendRequest("cards/".concat(e),{method:"DELETE",headers:this._headers})}}])&&l(t.prototype,n),e}();function f(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),h(this,"_handlePopupClose",(function(e){(e.target.classList.contains("popup__overlay")||e.target.classList.contains("popup__close"))&&n.close()})),h(this,"_handleEscClose",(function(e){"Escape"===e.key&&n.close()})),this._popup=t}var t,n;return t=e,(n=[{key:"open",value:function(){this._popup.classList.add("popup_opened"),this._popup.querySelector(".popup__content").classList.add("popup__content_opened"),document.addEventListener("keydown",this._handleEscClose)}},{key:"setEventListeners",value:function(){this._popup.addEventListener("click",this._handlePopupClose)}},{key:"close",value:function(){this._popup.classList.remove("popup_opened"),this._popup.querySelector(".popup__content").classList.remove("popup__content_opened"),this._removeEventListeners()}},{key:"_removeEventListeners",value:function(){document.removeEventListener("keydown",this._handleEscClose)}}])&&f(t.prototype,n),e}();function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function y(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function m(e,t,n){return(m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=g(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var k=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}(s,e);var t,n,o,r,i=(o=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=g(o);if(r){var n=g(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return b(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=i.call(this,e))._popup=e,t._popupImg=t._popup.querySelector(".popup__image"),t._popupTitle=t._popup.querySelector(".popup__title"),t}return t=s,(n=[{key:"open",value:function(e){this._cardImg=e.link,this._cardTitle=e.name,this._popupTitle.textContent=this._cardTitle,this._popupImg.src=this._cardImg,this._popupTitle.alt=this._cardTitle,m(g(s.prototype),"open",this).call(this)}}])&&y(t.prototype,n),s}(d);function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function C(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function w(e,t,n){return(w="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=P(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function L(e,t){return!t||"object"!==S(t)&&"function"!=typeof t?O(e):t}function O(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var q=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(s,e);var t,n,o,r,i=(o=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=P(o);if(r){var n=P(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return L(this,e)});function s(e,t){var n,o,r,u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),u=function(e){e.preventDefault(),n._handleFormSubmit(n._getInputValues())},(r="_submitForm")in(o=O(n=i.call(this,e)))?Object.defineProperty(o,r,{value:u,enumerable:!0,configurable:!0,writable:!0}):o[r]=u,n._popup=e,n._handleFormSubmit=t,n._inputList=n._popup.querySelectorAll(".popup__input"),n._form=n._popup.querySelector(".popup__form"),n._submitBtn=n._popup.querySelector(".popup__submit-btn"),n}return t=s,(n=[{key:"_getInputValues",value:function(){var e=this;return this._formValues={},this._inputList.forEach((function(t){e._formValues[t.name]=t.value})),this._formValues}},{key:"setEventListeners",value:function(){w(P(s.prototype),"setEventListeners",this).call(this),this._form.addEventListener("submit",this._submitForm)}},{key:"close",value:function(){w(P(s.prototype),"close",this).call(this),this._form.reset()}},{key:"loadingProcess",value:function(e){this._submitBtn.textContent=e}}])&&C(t.prototype,n),s}(d);function I(e){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function R(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function j(e,t,n){return(j="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=x(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function T(e,t){return(T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function B(e,t){return!t||"object"!==I(t)&&"function"!=typeof t?A(e):t}function A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var V=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&T(e,t)}(s,e);var t,n,o,r,i=(o=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=x(o);if(r){var n=x(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return B(this,e)});function s(e,t){var n,o,r,u;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),u=function(e){e.preventDefault(),n._api.deleteCard(n._cardItem._id).then((function(){n._card.remove(),n.close()})).catch((function(e){return console.log("АЛЯРМ!: ".concat(e))}))},(r="_submitForm")in(o=A(n=i.call(this,e)))?Object.defineProperty(o,r,{value:u,enumerable:!0,configurable:!0,writable:!0}):o[r]=u,n._api=t,n._popup=e,n}return t=s,(n=[{key:"open",value:function(e,t){this._card=t,this._cardItem=e,this._popup.addEventListener("submit",this._submitForm),j(x(s.prototype),"open",this).call(this)}},{key:"close",value:function(){j(x(s.prototype),"close",this).call(this),this._popup.removeEventListener("submit",this._submitForm)}}])&&R(t.prototype,n),s}(d),F=new u(e),N=new o(t,document.forms.popupAddForm),U=new o(t,document.forms.popupRedactForm),D=new o(t,document.forms.popupAvatarForm);N.enableValidation(),U.enableValidation(),D.enableValidation();var J=new p({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-23",headers:{authorization:"ac575190-0d35-42fd-b4c8-6b2b3e6183a4","Content-Type":"application/json"}});Promise.all([J.getUserInfo(),J.getCards()]).then((function(e){F.setUserInfo(e[0]),F.setNewAvatar(e[0]),M.renderCards(e[1])})).catch((function(e){return console.log("АЛЯРМ!: ".concat(e))}));var G=new k(document.querySelector(e.popupImg));G.setEventListeners();var H=new V(document.querySelector(e.popupDel),J);H.setEventListeners();var z=function(t){return new c(t,J,{selectors:e,handleCardClick:function(){G.open(t)},handleDelClick:function(e){H.open(t,e)}})},M=new i({renderer:function(e){var t=z(e),n=F.getUserInfo();M.addItem(t.generateCard(n))}},e),K=new q(document.querySelector(e.popupAdd),(function(e){K.loadingProcess("Создаём...");var t=e.cardName,n=e.cardLink;J.postCard(t,n).then((function(e){var t=z(e),n=F.getUserInfo();M.addItem(t.generateCard(n)),K.close()})).catch((function(e){return console.log("АЛЯРМ!: ".concat(e))})).finally((function(){K.loadingProcess("Создать")}))}));K.setEventListeners();var Q=new q(document.querySelector(e.popupAvatar),(function(e){Q.loadingProcess("Сохраняем..."),J.changeAvatar(e.avatarLink).then((function(e){F.setNewAvatar(e),Q.close()})).catch((function(e){return console.log("АЛЯРМ!: ".concat(e))})).finally((function(){Q.loadingProcess("Сохранить")}))}));Q.setEventListeners();var W=new q(document.querySelector(e.popupRedact),(function(e){W.loadingProcess("Сохраняем..."),J.changeUserInfo(e).then((function(e){F.setUserInfo(e),W.close()})).finally((function(){W.loadingProcess("Сохранить")}))}));W.setEventListeners(),document.querySelector(e.openPopupAvatarBut).addEventListener("click",(function(){D.removeValidationErrors(),Q.open()})),document.querySelector(e.openPopupRedactBut).addEventListener("click",(function(){document.forms.popupRedactForm.name.value=F.getUserInfo().titleName,document.forms.popupRedactForm.about.value=F.getUserInfo().subtitleJob,U.removeValidationErrors(),W.open()})),document.querySelector(e.openPopupAddBut).addEventListener("click",(function(){N.removeValidationErrors(),K.open()}))})();